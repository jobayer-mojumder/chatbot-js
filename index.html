<!DOCTYPE html>
<html>
<head>
	<title></title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">

</head>
<body>
	<div class="floating-chat">
		<i class="fa fa-comments" aria-hidden="true"></i>
		<div class="chat">
			<div class="header">
				<span class="title">
					what's on your mind?
				</span>
				<button>
					<i class="fa fa-times" aria-hidden="true"></i>
				</button>

			</div>
			<ul class="messages">
				
				<li class="self">Hi! I am Alena. How can I help you?</li>
			</ul>
			<div class="footer">
				<div class="text-box" id="message-text-box" contenteditable="true" disabled="true"></div>
				<button id="sendMessage">send</button>
			</div>
		</div>
	</div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<script>

	var sampledata = [
	{
		"question": "hi",
		"response": "Hello, How can i help you?"
	},

	{
		"question": "I want loan",
		"response": "what kind of loan do you want?"
	},
	{
		"question": "home loan",
		"response": "here is home loan link"
	},
	{
		"question": "Car loan",
		"response": "here is ecar loan link"
	},
	{
		"question": "Education loan",
		"response": "here is education loan link"
	},
	{
		"question": "Plane Loan",
		"response": "here is plane loan link"
	},
	{
		"question": "House loan",
		"response": "here is House loan link"
	},
	{
		"question": "Smiley",
		"response": "Hi! I am Alena. How can I help you?"
	},
	{
		"question": "Smiley",
		"response": "How can I help you?"
	},

	{
		"question": "Smiley",
		"response": "Hi! I am Alena."
	},

	{
		"question": "Smiley",
		"response": "Sorry! Something went wrong!"
	},

	];
	
	var element = $('.floating-chat');
	//var myStorage = localStorage;

	/*if (!myStorage.getItem('chatID')) {
		myStorage.setItem('chatID', createUUID());
	}*/

	setTimeout(function() {
		element.addClass('enter');
	}, 1000);

	element.click(openElement);

	//enter press send
	$('#message-text-box').keyup(function(){
		event.preventDefault();
		if (event.keyCode === 13) {
			sendNewMessage();
		}
	});

	function openElement() {
		var messages = element.find('.messages');
		var textInput = element.find('.text-box');
		element.find('>i').hide();
		element.addClass('expand');
		element.find('.chat').addClass('enter');
		var strLength = textInput.val().length * 2;
		textInput.keydown(onMetaAndEnter).prop("disabled", false).focus();
		element.off('click', openElement);
		element.find('.header button').click(closeElement);
		element.find('#sendMessage').click(sendNewMessage);
		messages.scrollTop(messages.prop("scrollHeight"));
	}

	function closeElement() {
		element.find('.chat').removeClass('enter').hide();
		element.find('>i').show();
		element.removeClass('expand');
		element.find('.header button').off('click', closeElement);
		element.find('#sendMessage').off('click', sendNewMessage);
		element.find('.text-box').off('keydown', onMetaAndEnter).prop("disabled", true).blur();
		setTimeout(function() {
			element.find('.chat').removeClass('enter').show()
			element.click(openElement);
		}, 500);
	}

	/*function createUUID() {
		var s = [];
		var hexDigits = "0123456789abcdef";
		for (var i = 0; i < 36; i++) {
			s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
		}
		s[14] = "4";
		s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
		s[8] = s[13] = s[18] = s[23] = "-";

		var uuid = s.join("");
		return uuid;
	}*/

	function sendNewMessage() {
		var userInput = $('.text-box');
		var newMessage = userInput.html().replace(/\<div\>|\<br.*?\>/ig, '\n').replace(/\<\/div\>/g, '').trim().replace(/\n/g, '<br>');

		if (!newMessage) return;

		//console.log(newMessage);

		var messagesContainer = $('.messages');

		messagesContainer.append([
			'<li class="other">',
			newMessage,
			'</li>'
			].join(''));

    	// clean out old message
    	userInput.html('');
    	// focus on input
    	userInput.focus();

    	messagesContainer.finish().animate({
    		scrollTop: messagesContainer.prop("scrollHeight")
    	}, 250);

    	setTimeout(function(){
    		replyMessage();
    	}, 500);
    }


    function replyMessage() {
    	var random = getRandom();
    	console.log(random);
    	var newMessage = sampledata[random].response;

    	if (!newMessage) return;

    	var messagesContainer = $('.messages');
    	messagesContainer.append([
    		'<li class="self">',
    		newMessage,
    		'</li>'
    		].join(''));
    	messagesContainer.finish().animate({
    		scrollTop: messagesContainer.prop("scrollHeight")
    	}, 250);
    }

    function onMetaAndEnter(event) {
    	if ((event.metaKey || event.ctrlKey) && event.keyCode == 13) {
    		sendNewMessage();
    	}
    }

    function getRandom(){
    	return Math.floor((Math.random() * 10) + 1);
    }

</script>
</html>